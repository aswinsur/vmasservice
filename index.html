<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VM Deployment Request</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background: #f7f9fc; }
  h1 { text-align:center; color:#333; }
  form { max-width: 720px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,.08); }
  label { display:block; margin-top:14px; font-weight:600; }
  input,select { width:100%; padding:10px; margin-top:6px; border:1px solid #cbd5e1; border-radius:8px; }
  button { margin-top:18px; background:#0078d4; color:#fff; border:0; padding:12px 16px; border-radius:10px; cursor:pointer; font-size:16px; }
  button:hover { background:#005a9e; }
  .row { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .banner { margin:14px 0 0; padding:10px 12px; border-radius:8px; font-size:14px; }
  .ok { background:#e6ffed; border:1px solid #81e6a8; color:#065f46; }
  .err { background:#fff5f5; border:1px solid #feb2b2; color:#9b2c2c; }
</style>
</head>
<body>

<h1>VM Deployment Request</h1>

<form id="vmForm" novalidate>
  <div class="row">
    <div>
      <label for="subscription_id">Subscription</label>
      <select id="subscription_id" required>
        <option value="">Select Subscription</option>
        <option value="41b68ebf-afca-41f2-bcbc-d54deff6d184">41b68ebf-afca-41f2-bcbc-d54deff6d184</option>
        <option value="cc684760-8f3d-4882-92de-b19e78706653">cc684760-8f3d-4882-92de-b19e78706653</option>
      </select>
    </div>
    <div>
      <label for="resource_group">Resource Group</label>
      <select id="resource_group" required>
        <option value="">Select Resource Group</option>
        <option value="persistent">persistent</option>
        <option value="rg-apps">rg-apps</option>
        <option value="rg-vm">rg-vm</option>
        <!-- add more RGs here if needed -->
      </select>
    </div>
  </div>

  <div class="row">
    <div>
      <label for="vnet">VNet</label>
      <select id="vnet" required>
        <option value="">Select VNet</option>
        <option value="vnet-eastus">vnet-eastus</option>
        <option value="vnet-test">vnet-eastus</option>
        <!-- add more VNets here if needed -->
      </select>
    </div>
    <div>
      <label for="region">Region</label>
      <select id="region" required>
        <option value="">Select Region</option>
        <option>East US</option>
        <option>Central India</option>
        <option>West Europe</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div>
      <label for="vm_size">VM Size</label>
      <select id="vm_size" required>
        <option value="">Select size</option>
        <option>Standard_DS1_v2</option>
        <option>Standard_DS2_v2</option>
        <option>Standard_B2s</option>
      </select>
    </div>
    <div>
      <label for="vm_name">VM Name</label>
      <input id="vm_name" required pattern="^[a-zA-Z0-9-]{1,64}$" title="Letters, numbers, and hyphens only (max 64 chars)" />
    </div>
  </div>

  <div class="row">
    <div>
      <label for="username">Username</label>
      <input id="username" required />
    </div>
    <div>
      <label for="password">Password</label>
      <input id="password" type="password" required />
    </div>
  </div>

  <button type="button" id="submitBtn">Check & Submit</button>
  <div id="msg" class="banner" hidden></div>
</form>

<script>
const LOGIC_APP_SUBMIT_URL = "https://prod-08.centralindia.logic.azure.com:443/workflows/a31d449082aa4424a679f74683f625c5/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=svnxQsFIDFhuqPV7Xu-rOVNJ474lairdvjoXOcSmTlY";

const $ = id => document.getElementById(id);
const msg = $('msg');

function showMsg(text, ok=false) {
  msg.hidden = false;
  msg.className = 'banner ' + (ok ? 'ok' : 'err');
  msg.textContent = text;
}
function clearMsg(){ msg.hidden = true; msg.textContent=''; }

$('submitBtn').addEventListener('click', async () => {
  clearMsg();

  // basic front-end validation
  const payload = {
    subscription_id: $('subscription_id').value,
    resource_group: $('resource_group').value,
    vnet: $('vnet').value,
    region: $('region').value,
    vm_size: $('vm_size').value,
    vm_name: $('vm_name').value.trim(),
    username: $('username').value,
    password: $('password').value
  };
  for (const k of Object.keys(payload)) {
    if (!payload[k]) { showMsg(`Please fill: ${k}`); return; }
  }
  // optional: enforce simple password length
  if (payload.password.length < 8) { showMsg('Password must be at least 8 characters'); return; }

  try {
    const res = await fetch(LOGIC_APP_SUBMIT_URL, {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify(payload)
    });
    const body = await res.json().catch(()=> ({}));

    if (!res.ok) {
      // Logic App returns 400 if VM exists
      showMsg(body.error || JSON.stringify(body) || `Request failed (${res.status})`);
    } else {
      showMsg(body.message || 'Request accepted. Approval email sent.', true);
      $('vmForm').reset();
    }
  } catch (e) {
    showMsg('Submit failed: ' + e);
  }
});
</script>
</body>
</html>
