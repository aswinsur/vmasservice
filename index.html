<!DOCTYPE html>
<html>
<head>
    <title>VM Deployment</title>
</head>
<body>
    <h1>VM Deployment Form</h1>

    <label>Subscription:</label>
    <select id="subscription" onchange="loadResourceGroups()"></select><br><br>

    <label>Resource Group:</label>
    <select id="resourceGroup" onchange="loadVNets()"></select><br><br>

    <label>VNet:</label>
    <select id="vnet"></select><br><br>

    <label>VM Name:</label>
    <input type="text" id="vmName" onblur="checkVMName()"><br><br>

    <p id="vmCheckResult" style="color:red;"></p>

    <script>
        const logicAppBaseUrl = "https://prod-27.centralindia.logic.azure.com:443/workflows/2a8a2f9f67804fecbaf108298b8eb12b/triggers/When_a_HTTP_request_is_received/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2FWhen_a_HTTP_request_is_received%2Frun&sv=1.0&sig=v-7BsVDKtlB0rXAPeQxaNC8exIpd5EL4VJ9YIPAtPEM";

        async function loadSubscriptions() {
            let res = await fetch(`${logicAppBaseUrl}/getSubscriptions`);
            let data = await res.json();
            let subDropdown = document.getElementById("subscription");
            subDropdown.innerHTML = "";
            data.forEach(sub => {
                subDropdown.innerHTML += `<option value="${sub.id}">${sub.displayName}</option>`;
            });
            loadResourceGroups();
        }

        async function loadResourceGroups() {
            let subId = document.getElementById("subscription").value;
            let res = await fetch(`${logicAppBaseUrl}/getResourceGroups?subscriptionId=${subId}`);
            let data = await res.json();
            let rgDropdown = document.getElementById("resourceGroup");
            rgDropdown.innerHTML = "";
            data.forEach(rg => {
                rgDropdown.innerHTML += `<option value="${rg.name}">${rg.name}</option>`;
            });
            loadVNets();
        }

        async function loadVNets() {
            let subId = document.getElementById("subscription").value;
            let rgName = document.getElementById("resourceGroup").value;
            let res = await fetch(`${logicAppBaseUrl}/getVNets?subscriptionId=${subId}&resourceGroup=${rgName}`);
            let data = await res.json();
            let vnetDropdown = document.getElementById("vnet");
            vnetDropdown.innerHTML = "";
            data.forEach(vnet => {
                vnetDropdown.innerHTML += `<option value="${vnet.name}">${vnet.name}</option>`;
            });
        }

        async function checkVMName() {
            let subId = document.getElementById("subscription").value;
            let rgName = document.getElementById("resourceGroup").value;
            let vmName = document.getElementById("vmName").value;
            if (!vmName) return;
            let res = await fetch(`${logicAppBaseUrl}/checkVM?subscriptionId=${subId}&resourceGroup=${rgName}&vmName=${vmName}`);
            let data = await res.json();
            document.getElementById("vmCheckResult").innerText = data.exists
                ? "VM name already exists in this resource group!"
                : "";
        }

        loadSubscriptions();
    </script>
</body>
</html>
